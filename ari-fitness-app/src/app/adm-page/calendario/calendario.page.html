<ion-row class="ion-justify-content-between ion-align-items-center monthControls">
  <ion-col (click)="goToPreviousMonth()">
    <ion-button fill="clear" shape="round">
      <ion-icon name="arrow-back-outline"></ion-icon>
    </ion-button>
  </ion-col>
  <ion-col>
    <ion-button fill="clear" shape="round">
      {{ currentDate.getMonth() + 1}} / {{ currentDate.getFullYear() }}
    </ion-button>
  </ion-col>
  <ion-col (click)="goToNextMonth()">
    <ion-button fill="clear" shape="round">
      <ion-icon name="arrow-forward-outline"></ion-icon>
    </ion-button>
  </ion-col>
</ion-row>
<ion-grid>
  <ion-row>
    <ion-col class="weekDays" *ngFor="let day of daysOfWeek">{{ day }}</ion-col>
  </ion-row>
  <ion-grid class="calendar">
    <ion-row class="week" *ngFor="let week of calendar">

      <ion-col *ngFor="let day of week" [class.disabled]="day === null" class="day position-relative"
        (click)="selectDay(day?.day)">

        {{ day ? day.day : '' }}


        <div *ngIf="(day?.events || []).length && !isMobile" class="point position-absolute top-0 start-0"
          (click)="scrollToList(day?.events)">
          <div class="point">
            <ion-chip size="small">{{day?.events?.length}}</ion-chip>
          </div>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-grid>


<ion-grid #eventList>
  <ion-row *ngFor="let event of events" (click)="openEventForm = true; completeForm(event)">
    <ion-col>
      <ion-card>
        <ion-card-content>
          <ion-card-subtitle>
            {{event.data_inicio | date: 'dd/MM/yyyy'}}
          </ion-card-subtitle>
          <div class="d-flex flew-wrap">
            @if(event.hora_inicio){
            <div class="d-flex align-items-center">
              <ion-icon name="time-outline" class="me-1"></ion-icon>
              <span>{{event.hora_inicio }}</span>
            </div>
            }
            @if(event.data_fim){
            <span class="ms-1 me-1"> até </span>
            <div class="d-flex align-items-center">
              <ion-icon name="time-outline" class="me-1"></ion-icon>
              <span> {{event.data_fim | date: 'dd/MM/yyyy'}} {{event.hora_fim }}</span>
            </div>}
          </div>

          <div class="d-flex w-100  align-items-center justify-content-between flex-wrap">
            <span>
              {{event.titulo}}
            </span>
            <!-- 1 - treino, 2 - aula, 3 - evento, 4 - palestra, 5 - curso, 6 - corrida, 7 - seminario, 8 - workshop, 9 - outros -->
            <ion-icon size="large" id="hover-trigger_{{event.id}}"
             [name]="event.tipo_evento_id === 1 ? 'barbell' :
              event.tipo_evento_id === 2 ? 'pencil' :
              event.tipo_evento_id === 3 ? 'paper-plane' :
              event.tipo_evento_id === 4 ? 'person' :
              event.tipo_evento_id === 5 ? 'library' :
              event.tipo_evento_id === 6 ? 'speedometer' :
              event.tipo_evento_id === 7 ? 'book' :
              event.tipo_evento_id === 8 ? 'construct' :
              event.tipo_evento_id === 9 ? 'sparkles' :

            ''"></ion-icon>

          </div>
          <ion-popover trigger="hover-trigger_{{event.id}}" triggerAction="hover" focusTrap="false" reference="trigger"
            showBackdrop="false" translucent="true">
            <ng-template>
              <ion-content class="ion-padding">{{event.tipo_evento.descricao | titlecase}}</ion-content>
            </ng-template>
          </ion-popover>
          <ion-card-header>
            <!-- <h6> -->
            <!-- </h6> -->
            {{event.descricao}}
          </ion-card-header>



        </ion-card-content>
      </ion-card>
    </ion-col>
  </ion-row>
</ion-grid>


<ion-modal [isOpen]="openEventForm" (didDismiss)="openEventForm = false; selectedDay = ''">
  <ng-template>
    <div class="ion-padding">
      <h4>Evento</h4>

      <form [formGroup]="eventForm" class="ion-text-left" (ionChange)="onFormChange($event)">
        <ion-grid>
          <ion-row>
            <ion-col size="6">
              <ion-input class="ion-text-left" formControlName="titulo" label="Titulo" labelPlacement="floating">
              </ion-input>
            </ion-col>
            <!-- tipo_evento_id -->
            <ion-col size="6">
              <ion-select class="ion-text-left" formControlName="tipo_evento_id" label="Tipo de Evento"
                interface="popover" labelPlacement="floating">
                <ion-select-option *ngFor="let tipo of tiposEventos" [value]="tipo.id">
                  {{tipo.name}}
                </ion-select-option>
              </ion-select>
            </ion-col>
            <ion-col size="12">
              <ion-input class="ion-text-left" formControlName="descricao" label="Descrição" labelPlacement="floating">
              </ion-input>
            </ion-col>
            <ion-col size="6">
              <ion-input class="ion-text-left" type="date" formControlName="data_inicio" label="Começa em"
                labelPlacement="floating">
              </ion-input>
            </ion-col>
            <ion-col size="6">
              <ion-input class="ion-text-left" type="time" formControlName="hora_inicio" label="Hora"
                labelPlacement="floating"></ion-input>
            </ion-col>
            <ion-col size="6">
              <ion-input class="ion-text-left" type="date" formControlName="data_fim" label="Termina em"
                labelPlacement="floating">
              </ion-input>
            </ion-col>
            <ion-col size="6">
              <ion-input class="ion-text-left" type="time" formControlName="hora_fim" label="Hora"
                labelPlacement="floating"></ion-input>
            </ion-col>

            <div class="d-flex justify-content-between align-items-center gap-3">

              <!-- Evento publico -->
              <ion-col size="6" class="ion-text-left">
                <ion-checkbox labelPlacement="end" formControlName="fl_publico">Evento Público</ion-checkbox>
              </ion-col>


            </div>
            <ion-col size="12">
              <ion-input class="ion-text-left" formControlName="local" label="Local" labelPlacement="floating">
              </ion-input>
            </ion-col>
            <!-- banner -->
            <ion-col size="12">
              <ion-input type="file" class="ion-text-left" formControlName="banner" (change)="onBannerChange($event)"
                label="Banner" labelPlacement="floating" accept="image/*">
              </ion-input>
            </ion-col>
          </ion-row>
        </ion-grid>

      </form>
      <ion-row class="position-fixed bottom-0 d-flex mb-2 me-2 end-0">
        <ion-col>
          <ion-button expand="block" type="submit" color="light" (click)="openEventForm = false">
            Cancelar
          </ion-button>
        </ion-col>
        <ion-col>
          <ion-button expand="block" type="submit" (click)="onSaveButtonClick()" [disabled]="!eventForm.valid">
            Salvar
          </ion-button>
        </ion-col>
      </ion-row>
    </div>
  </ng-template>

</ion-modal>
